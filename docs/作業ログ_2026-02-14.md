# 作業ログ：ひとへやLab 空想コレクション

**作業日**: 2026年2月14日（金）  
**サイトURL**: https://interior-gallery.pages.dev

---

## 🎯 やったこと（概要）

Notionのデータベースをバックエンドとした **インテリアギャラリーサイト** を作成し、
**Cloudflare Pages** で世界中に公開した。

---

## 📦 使用サービス（すべて無料）

| サービス | 用途 |
| :--- | :--- |
| **Notion** | コンテンツ管理（CMS）。部屋データ・画像・商品リンクを管理 |
| **Next.js** | Webアプリのフレームワーク |
| **GitHub** | ソースコードの管理（リポジトリ: `tufmatsu/interior-gallery`） |
| **Cloudflare Pages** | Webサイトのホスティング（公開） |

---

## 🔧 作業の流れ

### 1. Notionデータベースの準備
- Notion上にデータベースを作成（プロパティ: `name`, `image`, `description`, `slug`, `items`）
- Notion APIのインテグレーションを作成し、APIキーを取得
- データベースにインテグレーションを接続

### 2. Next.jsプロジェクトの作成
- `create-next-app` でプロジェクトを初期化
- Notion APIからデータを取得する仕組みを実装
- ギャラリー風のカードレイアウト＋モーダル表示を実装
- モバイル対応（レスポンシブデザイン）
- フワッと表示されるアニメーション

### 3. サイトの見た目の調整
- タイトル: **「ひとへやLabの空想コレクション」**
- サブタイトル: **「空想ひとりぐらし」のアーカイブ。**
- ヘッダー: **ひとへやLab**
- フッター: アフィリエイト広告利用の表記
- 「もっと見る」ボタンによるページネーション（6件ずつ表示）

### 4. 商品リンクの自動識別
- URLに応じて表示テキストと色が自動で変わる仕組み
  - 楽天リンク → 「楽天で見る ↗」（赤）
  - Amazonリンク → 「Amazonで見る ↗」（オレンジ）
  - その他 → 「サイトを見る ↗」（水色）

### 5. GitHubへのアップロード
- `git init` → `git remote add` → `git push` でGitHubに公開

### 6. Cloudflare Pagesへのデプロイ
- GitHubリポジトリとCloudflare Pagesを接続
- ビルドコマンド: `npx @cloudflare/next-on-pages@1`
- 出力ディレクトリ: `.vercel/output/static`
- 環境変数: `NOTION_API_KEY`, `NOTION_DATABASE_ID`, `NODE_VERSION`
- Compatibility flags: `nodejs_compat`, `nodejs_compat_populate_process_env`

### 7. デプロイ時に遭遇したエラーと対処

| エラー | 原因 | 対処 |
| :--- | :--- | :--- |
| Edge Runtimeエラー | APIルートにruntime指定がなかった | `export const runtime = 'edge'` を追加 |
| Node.JS Compatibility Error | compatibility flagが未設定 | `nodejs_compat` を設定 |
| データが表示されない | `@notionhq/client` がEdge非対応 | 直接 `fetch` でNotion APIを呼ぶように変更 |
| 環境変数が読めない | モジュールレベルで `process.env` を参照 | 関数内で読み取るように変更 |
| ソートエラー | プロパティ名 `Name` が存在しない | ソート指定を削除 |
| プロパティ不一致 | 大文字/小文字が違った（`Name` → `name`） | 全て小文字に修正 |
| 商品名が「Link」になる | items列のパース方法が違った | 2行1セット（商品名+URL）でパース |

---

## 📝 Notionでのデータ管理方法

### 部屋データの追加方法
Notionデータベースに新しい行を追加するだけ。サイトは自動で反映される（リロード時）。

### 各プロパティの意味

| プロパティ名 | 型 | 説明 |
| :--- | :--- | :--- |
| `name` | タイトル | 部屋の名前（例: 北欧風リビング） |
| `image` | ファイル | 部屋の画像 |
| `description` | テキスト | 部屋の説明文 |
| `slug` | テキスト | URL用の識別子（例: nordic-living） |
| `items` | テキスト | 商品リンク（2行で1セット: 商品名 → URL） |

### `items` の書き方（例）
```
Yチェア
https://a.r10.to/hgG0dP
ラウンドテーブル
https://a.r10.to/xxxxx
```

---

## 💰 費用

**すべて無料。** 課金の心配なし。
- Cloudflare Pages: 月500回ビルド、帯域無制限、Functions 1日10万リクエストまで無料
- Notion API: 無料プランで利用可能
- GitHub: 無料

---

## 🚀 今後やれること（メモ）
- テストデータの削除＆本番データの整備
- 独自ドメインの設定（Cloudflare Pages の Custom domains から）
- SNSシェアボタンの追加
- OGP画像の設定（SNSでシェアしたときのサムネイル）
